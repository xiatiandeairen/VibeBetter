# VibeBetter v0.4.0 版本规划

## 版本目标

> 从「能用的工具」进化为「有价值的产品」— 让用户接入真实仓库后能获得即时、可操作的 AI Coding 洞察。

### 核心方向

1. **真实数据接入**：OAuth 一键连接 GitHub，Webhook 实时数据推送
2. **深度分析**：指标下钻、趋势对比、风险传播图
3. **安全加固**：从 3/10 提升到 6/10
4. **测试覆盖**：从 29 个测试扩展到 100+ 个

---

## 特性清单

### P0：用户获取与数据闭环

| #    | 特性                      | 说明                                            | 预估 |
| ---- | ------------------------- | ----------------------------------------------- | ---- |
| F-01 | **GitHub OAuth SSO**      | 用 GitHub 账号一键登录，省去手动注册             | 2d   |
| F-02 | **GitHub Webhook 接入**   | 仓库配置 Webhook → PR 事件实时推送 → 即时风险评估 | 3d   |
| F-03 | **自动首次采集**          | 创建项目后自动触发首次 PR 数据采集 + 指标计算    | 1d   |
| F-04 | **PR 风险评分回写**       | 计算完成后将风险评分作为 GitHub Check 回写到 PR   | 2d   |

> **ROI**：这 4 个特性组合实现「用户连接 GitHub → 自动获得 AI Coding 洞察」的核心用户旅程。

### P1：深度分析能力

| #    | 特性                       | 说明                                            | 预估 |
| ---- | -------------------------- | ----------------------------------------------- | ---- |
| F-05 | **指标下钻交互**           | PSRI → 子维度 → 文件级三层钻取，面包屑导航       | 2d   |
| F-06 | **趋势对比**               | 选择两个时间段，对比 AI 成果率/PSRI/TDI 变化     | 1.5d |
| F-07 | **风险传播图**             | graphology 构建依赖图，可视化风险传播路径         | 3d   |
| F-08 | **PR 详情页**              | 点击 PR 查看：变更文件、AI 标记、风险评分、Review 轮数 | 1.5d |
| F-09 | **文件详情页**             | 点击文件查看：复杂度趋势、变更历史、AI 代码占比趋势 | 1.5d |

### P2：安全与工程质量

| #    | 特性                       | 说明                                            | 预估 |
| ---- | -------------------------- | ----------------------------------------------- | ---- |
| F-10 | **Refresh Token 机制**     | 短期 Access Token + 长期 Refresh Token           | 1d   |
| F-11 | **httpOnly Cookie**        | JWT 从 localStorage 迁移到 httpOnly Cookie       | 1d   |
| F-12 | **CORS 白名单**            | 生产环境限制为具体域名                           | 0.5d |
| F-13 | **API Rate Limiting**      | 登录/注册限流，防暴力破解                        | 0.5d |
| F-14 | **API 集成测试**           | 用 supertest 覆盖所有 API 端点                   | 3d   |
| F-15 | **前端 E2E 测试**          | Playwright 覆盖登录 → Dashboard → 决策流程       | 2d   |
| F-16 | **结构化日志**             | pino 替代 console.error，JSON 格式               | 1d   |

### P3：体验优化

| #    | 特性                       | 说明                                            | 预估 |
| ---- | -------------------------- | ----------------------------------------------- | ---- |
| F-17 | **全局状态管理**           | Zustand 管理项目选择、认证状态                   | 1d   |
| F-18 | **数据导出**               | CSV/JSON 格式导出指标数据                        | 1d   |
| F-19 | **通知/告警**              | 指标异常阈值告警（邮件/Slack Webhook）           | 2d   |
| F-20 | **国际化**                 | next-intl 支持中英文切换                         | 2d   |

---

## 架构演进

### v0.3 → v0.4 架构变更

```
v0.3                                    v0.4
──────                                  ──────
JWT localStorage                   →    httpOnly Cookie + Refresh Token
手动触发采集                        →    Webhook 自动推送 + 手动触发
console.error                      →    pino 结构化日志
无 OAuth                           →    GitHub OAuth SSO
无风险传播图                        →    graphology 依赖分析
0 集成测试                         →    supertest 全覆盖
0 前端 E2E                        →    Playwright 关键路径
```

### 新增基础设施

| 组件           | 用途                    |
| -------------- | ----------------------- |
| `next-auth`    | GitHub OAuth 集成       |
| `pino`         | 结构化日志              |
| `graphology`   | 依赖图分析              |
| `supertest`    | API 集成测试            |
| `playwright`   | 前端 E2E 测试           |
| `zustand`      | 全局状态管理            |

---

## 里程碑

```
Week 1-2          Week 3-4          Week 5-6
──────────        ──────────        ──────────
F-01~F-04         F-05~F-09         F-10~F-16
OAuth+Webhook     深度分析           安全+测试
用户获取闭环      分析深度           工程质量
```

| 里程碑        | 日期目标    | 交付                                    | Gate 标准                          |
| ------------- | ----------- | --------------------------------------- | ---------------------------------- |
| **v0.4-alpha**| Week 2 结束 | OAuth + Webhook + 自动采集              | GitHub 一键登录 → 自动获得洞察     |
| **v0.4-beta** | Week 4 结束 | 下钻 + 对比 + 风险图 + PR/文件详情      | 三层下钻可用 + 风险传播可视化      |
| **v0.4-rc**   | Week 6 结束 | 安全加固 + 测试覆盖 + 日志              | 安全评分 ≥6/10 + 测试 ≥100        |

---

## 评分目标

| 维度           | v0.3 现状 | v0.4 目标 | 提升路径                          |
| -------------- | --------- | --------- | --------------------------------- |
| 功能完成度     | 8/10      | 9/10      | OAuth + Webhook + 下钻 + 传播图  |
| 代码质量       | 6.5/10    | 8/10      | 集成测试 + E2E + 日志            |
| 架构合理性     | 7/10      | 8/10      | 全局状态 + 事件驱动              |
| 用户体验       | 8/10      | 8.5/10    | 下钻 + 对比 + 导出               |
| 安全性         | 3/10      | **6/10**  | Cookie + Refresh + CORS + Rate Limit |
| 性能           | 7/10      | 7.5/10    | 缓存优化                         |
| 文档完备度     | 8/10      | 8.5/10    | API 文档自动生成                  |
| 协作效率       | 9/10      | 9/10      | 保持                              |
| **综合目标**   | **7.15**  | **8.0+**  |                                   |

---

## 产品分化方向（展望 v0.5+）

VibeBetter 的核心能力（数据采集 → 指标计算 → 风险分析 → 决策建议）可复用于多种 Insight 场景：

| 产品方向                | 目标用户          | 核心指标                          | 与 VibeBetter 的关系         |
| ----------------------- | ----------------- | --------------------------------- | ---------------------------- |
| **DevOps Insight**      | SRE / DevOps      | 部署频率、MTTR、变更失败率        | 复用采集框架 + 指标引擎      |
| **Code Review Insight** | Tech Lead         | Review 时长、评论密度、知识分布   | 复用 GitHub 采集 + 分析引擎  |
| **Team Velocity Insight**| EM               | 吞吐量、WIP、Lead Time           | 复用 PR 数据 + 趋势分析     |
| **Security Insight**    | AppSec            | 漏洞密度、修复速度、依赖风险     | 复用文件指标 + 风险模型      |

> 架构原则：保持 Collector 插件化 + Metrics Engine 可配置 + Dashboard 可定制，使得新 Insight 产品只需定义「采集什么 + 算什么 + 展示什么」。
